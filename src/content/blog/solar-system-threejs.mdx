---
title: "Visualizando el Sistema Solar con NASA Horizons y Three.js"
description: "C√≥mo usar la API de NASA Horizons para obtener posiciones planetarias y visualizarlas en una app hecha con Three.js."
publishDate: 2023-12-14
tags:
  ["three.js", "NASA Horizons", "astronom√≠a", "data science", "visualizaci√≥n"]
image: "/assets/images/blog/solar-system-threejs/portada.webp"
---

Me encanta estar en constante aprendizaje sobre programaci√≥n, matem√°ticas, f√≠sica, astronom√≠a, etc. Aunque estoy lejos de ser un experto en cualquiera de estas materias, me apasiona aprender sobre ellas. Algo que me da mucha satisfacci√≥n es cuando logro conectar ideas o conceptos de distintos mundos. Esta vez, al descubrir la API Horizons de la NASA (de la cual hablar√© m√°s adelante), se me ocurri√≥ la idea: ¬øy si creo una aplicaci√≥n web con Three.js donde el usuario pueda seleccionar una fecha y ver reflejadas las posiciones de los planetas? Puedes ver el resultado aqu√≠:

[https://tonicanada.github.io/solar-system-threejs/](https://tonicanada.github.io/solar-system-threejs/)

En este art√≠culo hablar√© sobre el proceso de creaci√≥n de esta app. En uno de los cursos de ciencia de datos que estoy tomando, el instructor siempre dice que es esencial familiarizarse con los datos, y su mantra es: _visualizar, visualizar, visualizar‚Ä¶_ Crear la app me llev√≥ a visualizar el Sistema Solar de una manera que nunca antes hab√≠a visto. Me sorprendi√≥ no conocer muchos conceptos bastante b√°sicos.

## **Conceptos aprendidos al visualizar los datos**

Obviamente, sab√≠a que los planetas orbitan alrededor del Sol, y era consciente de que Mercurio era el m√°s cercano y Plut√≥n el m√°s lejano. Sin embargo, sol√≠a pensar que las √≥rbitas estaban en diferentes planos, como en esta imagen:

![√ìrbitas en distintos planos (representaci√≥n ficticia)](https://cdn.hashnode.com/res/hashnode/image/upload/v1702836378965/e8a9c3aa-047a-43f8-b0e2-3f7e8933ce30.png)

Al visualizar la app, me di cuenta de que, en realidad, todos los planetas (excepto Plut√≥n) est√°n m√°s o menos en el mismo plano orbital. Investigando encontr√© una raz√≥n: el Sistema Solar se form√≥ a partir de un disco rotante de gas y polvo.

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1703435471958/d7a31268-172b-4d00-9f63-573d36ba64e1.png)

No sab√≠a que los planetas m√°s cercanos al Sol tienen √≥rbitas m√°s el√≠pticas y se desplazan m√°s r√°pido. En esta tabla se ve cu√°ntas √≥rbitas completan por a√±o y el tiempo que demoran en hacerlo:

![](https://miro.medium.com/v2/resize:fit:685/1*aftyh8K4YE5zMgFy4mudOw.png)

Tambi√©n descubr√≠ que Mercurio, Venus, Tierra y Marte est√°n mucho m√°s cerca entre s√≠ (y del Sol) que el resto. Ahora entiendo el t√≠tulo de la pel√≠cula _2001: Odisea del espacio_: ‚ÄúJ√∫piter y m√°s all√°‚Äù üòÜ.

![√ìrbitas vistas desde arriba.](https://cdn.hashnode.com/res/hashnode/image/upload/v1702836570437/f44b98d3-93c2-4bd3-83de-7c033be9f301.png)

![√ìrbita entre Marte y el Sol ampliada.](https://cdn.hashnode.com/res/hashnode/image/upload/v1702836595287/79a1adcc-460c-46e4-af12-a7364dd17835.png)

Adem√°s, not√© que los planetas no siempre pasan por los mismos puntos. En la visualizaci√≥n se ve que las l√≠neas no tienen el mismo grosor (siendo Mercurio el caso m√°s claro), lo cual indica que no siguen siempre la misma elipse.

## **C√≥digo utilizado para desarrollar la app**

El [repositorio en GitHub](https://github.com/tonicanada/solar-system-horizons-nasa) tiene dos carpetas: `solar-system-data` (Python) y `solar-system-threejs` (Vite + Three.js). La primera se encarga de obtener datos desde la API Horizons de la NASA, y la segunda visualiza la informaci√≥n.

Al descubrir la [API Horizons de NASA](https://ssd-api.jpl.nasa.gov/doc/horizons.html), me emocion√©. Siempre imagin√© que deb√≠a existir una fuente de posiciones planetarias hist√≥ricas, pero nunca pens√© que fuera tan accesible.

La API puede consultarse por terminal:

```bash
telnet horizons.jpl.nasa.gov 6775
```

Aunque este modo es bastante _hacker_, tambi√©n se puede consultar v√≠a [API HTTP](https://ssd-api.jpl.nasa.gov/doc/horizons.html), que es m√°s c√≥modo. Cada ‚Äúobjeto‚Äù (planeta, estrella, sat√©lite, misi√≥n‚Ä¶) tiene un ID. Hay m√°s de 600 objetos disponibles.

![](https://miro.medium.com/v2/resize:fit:700/1*tC2JM-53KpDeIywxZV4S_Q.png)

Se pueden consultar propiedades y posiciones. Aqu√≠ un ejemplo de c√≥mo lo hice desde Python:

```python
def get_planet_positions_from_sun_csv(start_date, end_date, time_step, planet, output_folder):

    url = 'https://ssd.jpl.nasa.gov/api/horizons.api'

    param = {
        "format": "text",
        "COMMAND": planets[planet],
        "OBJ_DATA": "YES",
        "MAKE_EPHEM": "YES",
        "EPHEM_TYPE": "VECTORS",
        "CENTER": "@sun",
        "START_TIME": f"JD{str(convert_to_juliandate(start_date))}",
        "STOP_TIME": f"JD{str(convert_to_juliandate(end_date))}",
        "STEP_SIZE": time_step,
        "CSV_FORMAT": "YES"
    }

    ephem_exists = check_start_date_ephem_by_planet(start_date, planet)

    if ephem_exists:
        response = requests.get(url, params=param)
        content_txt = response.text

        start = content_txt.find("$$SOE")
        end = content_txt.find("$$EOE")

        data = content_txt[start + len("$$EOE"):end]

        # Remove the comma at the end of each line
        cleaned_data = '\n'.join(line.strip(',') for line in data.split('\n'))

        file_path = Path(output_folder) / f"{planet}_{start_date}_{end_date}.csv"

        with open(file_path, 'w', encoding="utf-8") as file:
            file.write(cleaned_data)
    else:
        print(f"No ephemeris for target '{planet}' for date {start_date}")
```

Us√© tiempo juliano porque permite trabajar con fechas a.C. El a√±o 0 JD equivale al 01-01-4713 a.C.

Horizons no tiene datos para todos los planetas antes de cierta fecha. Por eso, en la app, antes del 1600 d.C. solo aparecen Mercurio, Venus y Tierra.

![](https://miro.medium.com/v2/resize:fit:691/1*mynR0Vgkc4YP0KMA9WQ15w.png)

Tambi√©n descubr√≠ la librer√≠a [ephem](https://rhodesmill.org/pyephem/) en Python. No la us√© en detalle, pero tiene funciones interesantes.

El objetivo del script es generar archivos JSON como este:

```json
{
  "1751-01-01": {
    "Jupiter": [567870505.4387926, 480018874.0493847, -14677624.64057758],
    "Pluto": [-1659845741.404341, -4084639570.690031, 917754510.7325],
    "Earth": [-35105686.89957103, 142841146.0037219, 78731.25164704025],
    "Mercury": [28381752.76056007, -59184524.46478384, -7438604.424046163],
    "Uranus": [2551258418.697556, -1569295438.133674, -39231201.01378703],
    "Venus": [11102748.79937587, -108229322.7695824, -2047611.735988766],
    "Saturn": [-533303296.2827991, -1399738414.371662, 46102475.71358705],
    "Mars": [-211074066.189805, -112754985.9349335, 2949618.42168083],
    "Neptune": [-2367922191.058414, 3812768397.208968, -23965999.51064825]
  },
  "1751-01-06": {
    "Jupiter": [564137011.158541, 484586781.3215852, -14611742.24325112],
    "Pluto": [-1657611697.348931, -4085879026.118621, 917243104.6679108],
    "Earth": [-47660843.28146335, 139168197.3731036, 76127.27410317957],
    "Mercury": [41660692.40613102, -46515751.51663856, -7635150.727781702],
    "Uranus": [2552772489.484175, -1566920187.910375, -39241992.34731734],
    "Venus": [25894979.39666522, -105708287.6503585, -2871586.917012662],
    "Saturn": [-529639015.5941727, -1401233985.269415, 45984713.75110489],
    "Mars": [-205543380.1672792, -120999328.002768, 2638743.832780249],
    "Neptune": [-2369932753.068549, 3811547211.91458, -23894575.02123165]
  },
  "1751-01-11": {
    "Jupiter": [560369831.7803667, 489125487.5742517, -14544978.99913225],
    "Pluto": [-1655379598.629253, -4087119800.464841, 916731714.0704236],
    "Earth": [-59840515.57991014, 134416350.484194, 73357.95135698467],
    "Mercury": [50772514.64782426, -29272594.4568694, -7074363.546100765],
    "Uranus": [2554284127.146801, -1564543500.78105, -39252721.40614557],
    "Venus": [40191050.86081873, -101161595.8786273, -3640538.164681114],
    "Saturn": [-525970430.4813625, -1402718692.159617, 45866284.8403725],
    "Mars": [-199637655.1509095, -129022859.8676484, 2323055.78080599],
    "Neptune": [-2371942596.010034, 3810325122.270596, -23823110.77476954]
  },
...
}
```

## **App en Three.js**

La app es simple, construida con Vite. Tiene tres archivos principales y varios JSON con los datos. En `script.js` se crean el sol y los planetas como puntos, y se dibujan las √≥rbitas. Una funci√≥n `updatePositions` actualiza las posiciones seg√∫n la fecha.

Un detalle interesante fue lograr que los planetas se vean del mismo tama√±o sin importar la distancia de la c√°mara.

Tambi√©n us√© [Tweakpane](https://cocopon.github.io/tweakpane/) para que el usuario pueda cambiar la fecha f√°cilmente. Su implementaci√≥n est√° en `menu.js`.

Puedes probar la app online aqu√≠: [https://tonicanada.github.io/solar-system-threejs/](https://tonicanada.github.io/solar-system-threejs/)

![](https://miro.medium.com/v2/resize:fit:400/1*fOmfL4UCkdN7WyHUF80vNQ.png)

¬°Espero que te haya parecido interesante! Si fue as√≠, comp√°rtelo y s√≠gueme en [LinkedIn](https://www.linkedin.com/in/canadamomblant/), [Twitter](https://twitter.com/toni_canada) o [Facebook](https://www.facebook.com/toni.canada).
